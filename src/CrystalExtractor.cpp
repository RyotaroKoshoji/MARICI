#include "CrystalExtractor.h"

#include <vector>
#include <thread>

#include "ThreadingPolicy.h"

#include "ExtractCrystals.h"

using namespace MathematicalCrystalChemistry::Extraction;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

CrystalExtractor::CrystalExtractor() noexcept
	: _crystalExtractionTask{}
{
}

CrystalExtractor::CrystalExtractor(const CrystalExtractionTask& task) noexcept
	: _crystalExtractionTask{ task }
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void CrystalExtractor::execute() const
{
	std::vector<Internal::ExtractCrystals> crystalAnalyzers;
	{
		for (std::size_t threadRank = 0; threadRank < System::Parallel::ThreadingPolicy::maxThreading(); ++threadRank)
		{
			crystalAnalyzers.push_back(Internal::ExtractCrystals{ threadRank });
			crystalAnalyzers.back().setCrystalExtractionTask(_crystalExtractionTask);
		}
	}

	std::vector<std::thread> operatingSystems;
	{
		for (std::size_t threadRank = 0; threadRank < System::Parallel::ThreadingPolicy::maxThreading(); ++threadRank)
			operatingSystems.push_back(std::thread{ crystalAnalyzers[threadRank] });
	}


	for (auto& operatingSystem : operatingSystems)
		operatingSystem.join();
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
