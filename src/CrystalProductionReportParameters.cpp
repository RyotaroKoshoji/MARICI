#include "CrystalProductionReportParameters.h"

#include "LengthCasting.h"

#include "InvalidFileException.h"

using namespace MathematicalCrystalChemistry::Design::Diagnostics;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

double CrystalProductionReportParameters::s_defaultSpaceGroupPrecision{ MathToolkit::UnitConversion::LengthCasting::cast<MathToolkit::UnitConversion::LengthCasting::Unit::Angstrom, MathToolkit::UnitConversion::LengthCasting::Unit::AtomicUnit>(0.7) };


CrystalProductionReportParameters::CrystalProductionReportParameters() noexcept
	: _designedCrystalsDirectoryPath{}
	, _needPiSymmetryCrystalData{ false }
	, _needInfeasibleCrystalData{ false }
	, _needExceptionalCrystalData{ false }
	, _spaceGroupPrecision{ s_defaultSpaceGroupPrecision }
	, _crystalDesignRecordParameters{}
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void CrystalProductionReportParameters::initialize() noexcept
{
	_designedCrystalsDirectoryPath.clear();
	_needPiSymmetryCrystalData = false;
	_needInfeasibleCrystalData = false;
	_needExceptionalCrystalData = false;

	_spaceGroupPrecision = s_defaultSpaceGroupPrecision;
	_crystalDesignRecordParameters.initialize();
}

void CrystalProductionReportParameters::initialize(const System::IO::StreamReader& inputStreamReader)
{
	System::IO::StreamReader streamReader = inputStreamReader.getListBlock("&", "CRYSTAL_DESIGN_GENERIC");
	{
		if (!(streamReader.readParameter("Designed.Crystals.Directory.Path", _designedCrystalsDirectoryPath)))
			throw System::IO::InvalidFileException{ typeid(*this), "initialize", "Could not read Designed.Crystals.Directory.Path." };
	}
	{
		std::string piSymmetryCrystalDataNecessity;

		if (streamReader.readParameter("P1.Symmetry.Crystal.Data.Outputs", piSymmetryCrystalDataNecessity))
			_needPiSymmetryCrystalData = toDataNecessity(piSymmetryCrystalDataNecessity);
		else
			_needPiSymmetryCrystalData = false;
	}
	{
		std::string infeasibleCrystalDataNecessity;

		if (streamReader.readParameter("Infeasible.Crystal.Data.Outputs", infeasibleCrystalDataNecessity))
			_needInfeasibleCrystalData = toDataNecessity(infeasibleCrystalDataNecessity);
		else
			_needInfeasibleCrystalData = false;
	}
	{
		std::string exceptionalCrystalDataNecessity;

		if (streamReader.readParameter("Exceptional.Crystal.Data.Outputs", exceptionalCrystalDataNecessity))
			_needExceptionalCrystalData = toDataNecessity(exceptionalCrystalDataNecessity);
		else
			_needExceptionalCrystalData = false;
	}
	{
		using namespace MathToolkit::UnitConversion;
		double precisionAngstrom = 0.0;

		if (streamReader.readParameter("Space.Group.Precision", precisionAngstrom))
			_spaceGroupPrecision = LengthCasting::cast<LengthCasting::Unit::Angstrom, LengthCasting::Unit::AtomicUnit>(precisionAngstrom);
		else
			_spaceGroupPrecision = s_defaultSpaceGroupPrecision;
	}

	_crystalDesignRecordParameters.initialize(streamReader);


	validateInitializedValues();
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

bool CrystalProductionReportParameters::toDataNecessity(const std::string& inputTexts) const
{
	if (inputTexts == "ON" || inputTexts == "On" || inputTexts == "on")
		return true;

	else if (inputTexts == "OFF" || inputTexts == "Off" || inputTexts == "off")
		return false;

	else
		throw System::IO::InvalidFileException{ typeid(*this), "toDataNecessity", "Could not read Infeasible.Crystal.Data.Output." };
}

void CrystalProductionReportParameters::validateInitializedValues() const
{
	if (_spaceGroupPrecision < 0.0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Space.Group.Precision\" is less than zero." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
