#include "RandomStructureGenerationParameters.h"

#include "FileStream.h"
#include "InvalidOperationException.h"

#include "AngleCasting.h"

using namespace MathematicalCrystalChemistry::Design::Generation;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructor

double RandomStructureGenerationParameters::s_defaultInitialPackingFraction{ 0.7 };
double RandomStructureGenerationParameters::s_defaultMaxInitialLatticeLengthRatio{ 3.0 };
double RandomStructureGenerationParameters::s_defaultMaxInitialLatticeAngle{ MathToolkit::UnitConversion::AngleCasting::cast<MathToolkit::UnitConversion::AngleCasting::Unit::Degree, MathToolkit::UnitConversion::AngleCasting::Unit::Radian>(120) };
double RandomStructureGenerationParameters::s_defaultMinInitialLatticeAngle{ MathToolkit::UnitConversion::AngleCasting::cast<MathToolkit::UnitConversion::AngleCasting::Unit::Degree, MathToolkit::UnitConversion::AngleCasting::Unit::Radian>(60) };


RandomStructureGenerationParameters::RandomStructureGenerationParameters() noexcept
	: _initialPackingFraction{ s_defaultInitialPackingFraction }
	, _maxInitialLatticeLengthRatio{ s_defaultMaxInitialLatticeLengthRatio }
	, _maxInitialLatticeAngle{ s_defaultMaxInitialLatticeAngle }
	, _minInitialLatticeAngle{ s_defaultMinInitialLatticeAngle }
{
}

// Constructor
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

void RandomStructureGenerationParameters::setInitialLatticeAngles(const double minAngle, const double maxAngle)
{
	using namespace MathToolkit::UnitConversion;


	if (minAngle < 0.0)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "setInitialLatticeAngles", "Maximum initial lattice angle is less than zero." };
	else
	{
		if (AngleCasting::cast<AngleCasting::Unit::Degree, AngleCasting::Unit::Radian>(180) < _maxInitialLatticeAngle)
			throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "setInitialLatticeAngles", "Maximum initial lattice angle is more than 180 degree." };
		else
		{
			if (_minInitialLatticeAngle < 0.0)
				throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "setInitialLatticeAngles", "Minimum initial lattice angle is less than zero." };
			else
			{
				if (AngleCasting::cast<AngleCasting::Unit::Degree, AngleCasting::Unit::Radian>(180) < _minInitialLatticeAngle)
					throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "setInitialLatticeAngles", "Minimum initial lattice angle is more than 180 degree." };
				else
				{
					if (maxAngle < minAngle)
						throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "setInitialLatticeAngles", "Maximum initial lattice angle is less than minimum initial lattice angle." };

					else
					{
						_maxInitialLatticeAngle = maxAngle;
						_minInitialLatticeAngle = minAngle;
					}
				}
			}
		}
	}
}

// Constructor
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void RandomStructureGenerationParameters::initialize() noexcept
{
	_initialPackingFraction = s_defaultInitialPackingFraction;
	_maxInitialLatticeLengthRatio = s_defaultMaxInitialLatticeLengthRatio;
	_maxInitialLatticeAngle = s_defaultMaxInitialLatticeAngle;
	_minInitialLatticeAngle = s_defaultMinInitialLatticeAngle;
}

void RandomStructureGenerationParameters::initialize(const System::IO::StreamReader& streamReader)
{
	using namespace MathToolkit::UnitConversion::AngleCasting;	
	initialize();

	if (!(streamReader.readParameter("Initial.Packing.Fraction", _initialPackingFraction)))
		_initialPackingFraction = s_defaultInitialPackingFraction;

	if (!(streamReader.readParameter("Maximum.Lattice.Length.Ratio", _maxInitialLatticeLengthRatio)))
		_maxInitialLatticeLengthRatio = s_defaultMaxInitialLatticeLengthRatio;

	{
		double angleDegree = 0.0;

		if (streamReader.readParameter("Maximum.Lattice.Angle", angleDegree))
			_maxInitialLatticeAngle = cast<Unit::Degree, Unit::Radian>(angleDegree);
		else
			_maxInitialLatticeAngle = s_defaultMaxInitialLatticeAngle;
	}
	{
		double angleDegree = 0.0;

		if (streamReader.readParameter("Minimum.Lattice.Angle", angleDegree))
			_minInitialLatticeAngle = cast<Unit::Degree, Unit::Radian>(angleDegree);
		else
			_minInitialLatticeAngle = s_defaultMinInitialLatticeAngle;
	}


	validateParameters();
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

void RandomStructureGenerationParameters::validateParameters() const
{
	using namespace MathToolkit::UnitConversion;


	if (_initialPackingFraction <= 0.0)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Initial.Packing.Fraction is not more than zero." };

	if (1.0 <= _initialPackingFraction)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Initial.Packing.Fraction is not less than one." };

	if (_maxInitialLatticeLengthRatio < 1.0)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Maximum.Initial.Lattice.Length.Ratio is less than one." };

	if (_maxInitialLatticeAngle < 0.0)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Maximum.Initial.Lattice.Angle is less than zero." };

	if (AngleCasting::cast<AngleCasting::Unit::Degree, AngleCasting::Unit::Radian>(180) < _maxInitialLatticeAngle)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Maximum.Initial.Lattice.Angle is more than 180 degree." };

	if (_minInitialLatticeAngle < 0.0)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Minimum.Initial.Lattice.Angle is less than zero." };

	if (AngleCasting::cast<AngleCasting::Unit::Degree, AngleCasting::Unit::Radian>(180) < _minInitialLatticeAngle)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Minimum.Initial.Lattice.Angle is more than 180 degree." };

	if (_maxInitialLatticeAngle < _minInitialLatticeAngle)
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateParameters", "Maximum.Initial.Lattice.Angle is less than Minimum.Initial.Lattice.Angle." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
