#include "LinkedPolyhedraRetriever.h"

#include <unordered_map>

using namespace MathematicalCrystalChemistry::CrystalModel::Components::Internal;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

LinkedPolyhedraRetriever::LinkedPolyhedraRetriever() noexcept
	: CoordinationPolyhedraRetriever{}
	, _feasiblePolyhedraConnections{}
{
}

LinkedPolyhedraRetriever::LinkedPolyhedraRetriever(const ChemToolkit::Crystallography::UnitCell& cell) noexcept
	: CoordinationPolyhedraRetriever{ cell }
	, _feasiblePolyhedraConnections{}
{
}

LinkedPolyhedraRetriever::LinkedPolyhedraRetriever(const ChemToolkit::Crystallography::UnitCell& cell, const std::vector<ConstrainingAtom>& atoms) noexcept
	: CoordinationPolyhedraRetriever{ cell, atoms }
	, _feasiblePolyhedraConnections{}
{
}

LinkedPolyhedraRetriever::LinkedPolyhedraRetriever(const ChemToolkit::Crystallography::UnitCell& cell, std::vector<ConstrainingAtom>&& atoms) noexcept
	: CoordinationPolyhedraRetriever{ cell, std::move(atoms) }
	, _feasiblePolyhedraConnections{}
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Public methods

LinkedPolyhedraRetriever::LinkingList LinkedPolyhedraRetriever::getCoordinationPolyhedraLinkings() const
{
	LinkingDictionary linkingDictionary;
	{
		for (size_type originalAtomIndex = 0; originalAtomIndex < atoms().size(); ++originalAtomIndex)
		{
			std::vector<OriginalAtomIndex> chemicalBondedOriginalAtomIndices;
			std::vector<TranslatedAtomIndex> chemicalBondedTranslatedAtomIndices;
			{
				for (const auto& originalBondedIndex : atoms()[originalAtomIndex].getCovalentBondedOriginalAtomIndices())
					chemicalBondedOriginalAtomIndices.push_back(originalBondedIndex);

				for (const auto& originalBondedIndex : atoms()[originalAtomIndex].getIonicBondedOriginalAtomIndices())
					chemicalBondedOriginalAtomIndices.push_back(originalBondedIndex);

				for (const auto& translatedBondedIndex : atoms()[originalAtomIndex].getCovalentBondedTranslatedAtomIndices())
					chemicalBondedTranslatedAtomIndices.push_back(translatedBondedIndex);

				for (const auto& translatedBondedIndex : atoms()[originalAtomIndex].getIonicBondedTranslatedAtomIndices())
					chemicalBondedTranslatedAtomIndices.push_back(translatedBondedIndex);
			}


			addPolyhedraLinkings(originalAtomIndex, chemicalBondedOriginalAtomIndices, linkingDictionary);
			addPolyhedraLinkings(originalAtomIndex, chemicalBondedTranslatedAtomIndices, linkingDictionary);
			addPolyhedraLinkings(originalAtomIndex, chemicalBondedOriginalAtomIndices, chemicalBondedTranslatedAtomIndices, linkingDictionary);
		}
	}


	LinkingList coordinationPolyhedraLinkings;
	{
		for (const auto& linkingAndBridging : linkingDictionary)
			coordinationPolyhedraLinkings.push_back(std::make_pair(linkingAndBridging.first, linkingAndBridging.second));
	}

	return coordinationPolyhedraLinkings;
}

// Public methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
