#include "CrystalDesignRecordParameters.h"

#include "DateTime.h"

#include "Directory.h"
#include "FileStream.h"
#include "InvalidFileException.h"

using namespace MathematicalCrystalChemistry::Design::Diagnostics;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructor

CrystalDesignRecordParameters::CrystalDesignRecordParameters() noexcept
	: _mdRecordFrequency{ 0 }
	, _crystalFactoryDirectoryPath{}
{
}

// Constructor
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

std::filesystem::path CrystalDesignRecordParameters::getCrystalProductionDirectoryPath() const
{
	std::filesystem::path crystalProductionDirectoryPath{ _crystalFactoryDirectoryPath };
	{
		size_type directoryCount = System::IO::Directory::countDirectories(crystalProductionDirectoryPath);

		crystalProductionDirectoryPath /= "Production_";
		crystalProductionDirectoryPath += std::to_string(directoryCount);
	}

	return crystalProductionDirectoryPath;
}

void CrystalDesignRecordParameters::initialize() noexcept
{
	_mdRecordFrequency = 0;
	_crystalFactoryDirectoryPath.clear();
}

void CrystalDesignRecordParameters::initialize(const System::IO::StreamReader& streamReader)
{
	if (!(streamReader.readParameter("MD.Record.Frequency", _mdRecordFrequency)))
		_mdRecordFrequency = 0;

	if (!(streamReader.readParameter("Crystal.Factory.Directory.Path", _crystalFactoryDirectoryPath)))
		throw System::IO::InvalidFileException{ typeid(*this), "initialize", "Could not read Crystal.Factory.Directory.Path." };
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
