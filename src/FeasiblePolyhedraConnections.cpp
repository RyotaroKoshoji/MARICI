#include "FeasiblePolyhedraConnections.h"

#include "FeasiblePolyhedraConnectionsDictionary.h"

using namespace MathematicalCrystalChemistry::CrystalModel::Constraints;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

FeasiblePolyhedraConnections::FeasiblePolyhedraConnections() noexcept
	: _dictionary{}
{
	for (const auto& keyAndComposition : FeasiblePolyhedraConnectionsDictionary::getDictionary())
		_dictionary.emplace(keyAndComposition.first, keyAndComposition.second);
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

FeasiblePolyhedraConnections::ChemicalComposition FeasiblePolyhedraConnections::getClosestFeasibleCommonBridgingComposition(const IonicAtomicNumber& iana, const IonicAtomicNumber& ianb, const ChemicalComposition& commonBridgingComposition) const
{
	auto iter = _dictionary.find(getIonicAtomicNumberKey(iana, ianb));


	if (iter == _dictionary.end())
		return commonBridgingComposition;

	else
	{
		ChemicalComposition closestComposition;
		{
			for (const auto& feasibleComposition : iter->second)
			{
				if (commonBridgingComposition < feasibleComposition)
					break;

				else if (feasibleComposition == commonBridgingComposition)
					return commonBridgingComposition;

				else
				{
					bool isLowerFeasibleComposition = true;
					{
						for (const auto& numAndCount : feasibleComposition)
						{
							if (commonBridgingComposition.count(numAndCount.first) < numAndCount.second)
							{
								isLowerFeasibleComposition = false;
								break;
							}
						}
					}

					if (isLowerFeasibleComposition)
						closestComposition = feasibleComposition;
				}
			}
		}

		return closestComposition;
	}
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
