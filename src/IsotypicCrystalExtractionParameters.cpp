#include "IsotypicCrystalExtractionParameters.h"

#include "LengthCasting.h"

#include "Directory.h"
#include "DirectoryNotFoundException.h"
#include "InvalidFileException.h"

#include "CrystalExtractionTask.h"

using namespace MathematicalCrystalChemistry::Analysis;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

double IsotypicCrystalExtractionParameters::s_defaultSpaceGroupPrecision{ MathematicalCrystalChemistry::Extraction::CrystalExtractionTask::defaultSpaceGroupPrecision() };


IsotypicCrystalExtractionParameters::IsotypicCrystalExtractionParameters() noexcept
	: _needExtraction{ false }
	, _databaseDirectoryPath{}
	, _spaceGroupPrecision{ s_defaultSpaceGroupPrecision }
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

void IsotypicCrystalExtractionParameters::setDatabaseDirectoryPath(const std::filesystem::path& directoryPath)
{
	if (System::IO::Directory::exist(directoryPath))
		_databaseDirectoryPath = directoryPath;
	else
		throw System::IO::DirectoryNotFoundException{ typeid(*this), "setDatabaseDirectoryPath", "Argument path is not a path to a directory." };
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void IsotypicCrystalExtractionParameters::initialize() noexcept
{
	_needExtraction = false;
	_databaseDirectoryPath.clear();
	_spaceGroupPrecision = s_defaultSpaceGroupPrecision;
}

void IsotypicCrystalExtractionParameters::initialize(const System::IO::StreamReader& inputStreamReader)
{
	System::IO::StreamReader genericStreamReader = inputStreamReader.getListBlock("&", "CRYSTAL_EXTRACTION_GENERIC");
	{
		std::string necessityTexts;

		if (genericStreamReader.readParameter("Isotypic.Crystal.Extraction", necessityTexts))
			_needExtraction = toNecessity(necessityTexts);
		else
			_needExtraction = false;
	}
	{
		double precisionAngstrom = 0.0;

		using namespace MathToolkit::UnitConversion;

		if (genericStreamReader.readParameter("Space.Group.Precision", precisionAngstrom))
			_spaceGroupPrecision = LengthCasting::cast<LengthCasting::Unit::Angstrom, LengthCasting::Unit::AtomicUnit>(precisionAngstrom);
		else
			_spaceGroupPrecision = s_defaultSpaceGroupPrecision;
	}

	genericStreamReader.readParameter("Crystal.Database.Directory.Path", _databaseDirectoryPath);
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

bool IsotypicCrystalExtractionParameters::toNecessity(const std::string& inputTexts) const
{
	if (inputTexts == "ON" || inputTexts == "On" || inputTexts == "on")
		return true;

	else if (inputTexts == "OFF" || inputTexts == "Off" || inputTexts == "off")
		return false;

	else
		throw System::IO::InvalidFileException{ typeid(*this), "toNecessity", "Could not read necessity texts." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************

