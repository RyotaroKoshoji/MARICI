#include "GeometricalConstraintParameters.h"

#include <limits>

#include "InvalidFileException.h"

using namespace MathematicalCrystalChemistry::Design::Optimization;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

GeometricalConstraintParameters::size_type GeometricalConstraintParameters::s_defaultInteratomicDistanceTracerTimeout{ 100 };
GeometricalConstraintParameters::size_type GeometricalConstraintParameters::s_defaultUnitCellReductionTimeout{ 200 };
double GeometricalConstraintParameters::s_defaultMinimumExclusionDistanceRatio{ 1.3 };
double GeometricalConstraintParameters::s_defaultInteratomicDistanceTracerCutoffRatio{ 4.0 };
double GeometricalConstraintParameters::s_defaultInteratomicDistanceConstrainerCutoffRatio{ 2.0 };


GeometricalConstraintParameters::GeometricalConstraintParameters() noexcept
	: _interatomicDistanceTracerTimeout{ s_defaultInteratomicDistanceTracerTimeout }
	, _unitCellReductionTimeout{ s_defaultUnitCellReductionTimeout }
	, _minimumExclusionDistanceRatio{ s_defaultMinimumExclusionDistanceRatio }
	, _interatomicDistanceTracerCutoffRatio{ s_defaultInteratomicDistanceTracerCutoffRatio }
	, _interatomicDistanceConstrainerCutoffRatio{ s_defaultInteratomicDistanceConstrainerCutoffRatio }
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void GeometricalConstraintParameters::initialize() noexcept
{
	_interatomicDistanceTracerTimeout = s_defaultInteratomicDistanceTracerTimeout;
	_unitCellReductionTimeout = s_defaultUnitCellReductionTimeout;
	_minimumExclusionDistanceRatio = s_defaultMinimumExclusionDistanceRatio;
	_interatomicDistanceTracerCutoffRatio = s_defaultInteratomicDistanceTracerCutoffRatio;
	_interatomicDistanceConstrainerCutoffRatio = s_defaultInteratomicDistanceConstrainerCutoffRatio;
}

void GeometricalConstraintParameters::initialize(const System::IO::StreamReader& streamReader)
{
	initialize();

	if (!(streamReader.readParameter("Interatomic.Distance.Tracer.Timeout", _interatomicDistanceTracerTimeout)))
		setInteratomicDistanceTracerTimeout();

	if (!(streamReader.readParameter("Unit.Cell.Reduction.Timeout", _unitCellReductionTimeout)))
		setUnitCellReductionTimeout();

	if (!(streamReader.readParameter("Minimum.Exclusion.Distance.Ratio", _minimumExclusionDistanceRatio)))
		setMinimumExclusionDistanceRatio();
	
	if (!(streamReader.readParameter("Interatomic.Distance.Tracer.Cutoff.Ratio", _interatomicDistanceTracerCutoffRatio)))
		setInteratomicDistanceTracerCutoffRatio();

	if (!(streamReader.readParameter("Interatomic.Distance.Constrainer.Cutoff.Ratio", _interatomicDistanceConstrainerCutoffRatio)))
		setInteratomicDistanceConstrainerCutoffRatio();


	validateInitializedValues();
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

void GeometricalConstraintParameters::validateInitializedValues()
{
	if (_interatomicDistanceTracerTimeout == 0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Interatomic.Distance.Tracer.Timeout\" is zero." };

	if (_unitCellReductionTimeout == 0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Unit.Cell.Reduction.Timeout\" is zero." };

	if (_minimumExclusionDistanceRatio < 1.0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Minimum.Exclusion.Distance.Ratio\" is less than zero." };

	if (_interatomicDistanceTracerCutoffRatio < 1.0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Interatomic.Distance.Tracer.Cutoff.Ratio\" is less than one." };

	if (_interatomicDistanceConstrainerCutoffRatio < 1.0)
		throw System::IO::InvalidFileException{ typeid(*this), "validateInitializedValues", "\"Interatomic.Distance.Constrainer.Cutoff.Ratio\" is less than one." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
