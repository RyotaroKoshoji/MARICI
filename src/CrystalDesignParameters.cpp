#include "CrystalDesignParameters.h"

#include "InvalidFileException.h"

#include "AtomicRadiusDictionary.h"
#include "CoordinationConstraintsDictionary.h"
#include "FeasiblePolyhedraConnectionsDictionary.h"

using namespace MathematicalCrystalChemistry::Design;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

CrystalDesignParameters::size_type CrystalDesignParameters::s_defaultMaxCeaselessGlobalStructuralOptimizing{ 2500 };


CrystalDesignParameters::CrystalDesignParameters() noexcept
	: _maxTotalStructuralOptimizing{ 0 }
	, _maxCeaselessGlobalStructuralOptimizing{ s_defaultMaxCeaselessGlobalStructuralOptimizing }
	, _initialStructureGenerationParameters{}
	, _geometricalConstraintParameters{}
	, _globalStructuralOptimizationParameters{}
	, _localStructuralOptimizationParameters{}
	, _preciseStructuralOptimizationParameters{}
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void CrystalDesignParameters::initialize() noexcept
{
	_maxTotalStructuralOptimizing = 0;
	_maxCeaselessGlobalStructuralOptimizing = s_defaultMaxCeaselessGlobalStructuralOptimizing;

	_initialStructureGenerationParameters.initialize();
	_geometricalConstraintParameters.initialize();

	_globalStructuralOptimizationParameters.initialize();
	_localStructuralOptimizationParameters.initialize();
	_preciseStructuralOptimizationParameters.initialize();


	MathematicalCrystalChemistry::CrystalModel::Constraints::AtomicRadiusDictionary::initialize();
	MathematicalCrystalChemistry::CrystalModel::Constraints::CoordinationConstraintsDictionary::initialize();
	MathematicalCrystalChemistry::CrystalModel::Constraints::FeasiblePolyhedraConnectionsDictionary::initialize();
}

void CrystalDesignParameters::initialize(const System::IO::StreamReader& streamReader)
{
	System::IO::StreamReader genericStreamReader = streamReader.getListBlock("&", "CRYSTAL_DESIGN_GENERIC");
	{
		if (!(genericStreamReader.readParameter("Maximum.Number.of.Structural.Optimization.Steps", _maxTotalStructuralOptimizing)))
			throw System::IO::InvalidFileException{ typeid(*this), "initialize", "Could not read Maximum.Number.of.Structural.Optimization.Steps." };

		if (!(genericStreamReader.readParameter("Maximum.Number.of.Ceaseless.Global.Structural.Optimization.Steps", _maxCeaselessGlobalStructuralOptimizing)))
			_maxCeaselessGlobalStructuralOptimizing = s_defaultMaxCeaselessGlobalStructuralOptimizing;
	}

	_initialStructureGenerationParameters.initialize(streamReader.getListBlock("&", "INITIAL_STRUCTURE_GENERATION"));
	_geometricalConstraintParameters.initialize(streamReader.getListBlock("&", "GEOMETRICAL_CONSTRAINTS"));

	_globalStructuralOptimizationParameters.initialize(streamReader.getListBlock("&", "GLOBAL_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::global);
	_localStructuralOptimizationParameters.initialize(streamReader.getListBlock("&", "LOCAL_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::local);
	_preciseStructuralOptimizationParameters.initialize(streamReader.getListBlock("&", "PRECISE_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::precise);


	MathematicalCrystalChemistry::CrystalModel::Constraints::AtomicRadiusDictionary::initialize(streamReader.getListBlock("&", "ATOMIC_RADIUS"));
	MathematicalCrystalChemistry::CrystalModel::Constraints::CoordinationConstraintsDictionary::initialize(streamReader);
	MathematicalCrystalChemistry::CrystalModel::Constraints::FeasiblePolyhedraConnectionsDictionary::initialize(streamReader);
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
