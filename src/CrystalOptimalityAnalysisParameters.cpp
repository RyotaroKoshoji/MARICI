#include "CrystalOptimalityAnalysisParameters.h"

#include "InvalidFileException.h"

using namespace MathematicalCrystalChemistry::Analysis;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

CrystalOptimalityAnalysisParameters::CrystalOptimalityAnalysisParameters() noexcept
	: _needAnalysis{ false }
	, _geometricalConstraintParameters{}
	, _globalStructuralOptimizationParameters{}
	, _localStructuralOptimizationParameters{}
	, _preciseStructuralOptimizationParameters{}
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

void CrystalOptimalityAnalysisParameters::initialize() noexcept
{
	_needAnalysis = false;

	_geometricalConstraintParameters.initialize();
	_globalStructuralOptimizationParameters.initialize();
	_localStructuralOptimizationParameters.initialize();
	_preciseStructuralOptimizationParameters.initialize();
}

void CrystalOptimalityAnalysisParameters::initialize(const System::IO::StreamReader& inputStreamReader)
{
	System::IO::StreamReader genericStreamReader = inputStreamReader.getListBlock("&", "CRYSTAL_EXTRACTION_GENERIC");
	{
		std::string necessityTexts;

		if (genericStreamReader.readParameter("Crystal.Optimality.Analysis", necessityTexts))
			_needAnalysis = toNecessity(necessityTexts);
		else
			_needAnalysis = false;
	}
	_geometricalConstraintParameters.initialize(inputStreamReader.getListBlock("&", "GEOMETRICAL_CONSTRAINTS"));
	_globalStructuralOptimizationParameters.initialize(inputStreamReader.getListBlock("&", "GLOBAL_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::global);
	_localStructuralOptimizationParameters.initialize(inputStreamReader.getListBlock("&", "LOCAL_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::local);
	_preciseStructuralOptimizationParameters.initialize(inputStreamReader.getListBlock("&", "PRECISE_STRUCTURAL_OPTIMIZATION"), StructuralOptimizationParameters::OptimizationType::precise);
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

bool CrystalOptimalityAnalysisParameters::toNecessity(const std::string& inputTexts) const
{
	if (inputTexts == "ON" || inputTexts == "On" || inputTexts == "on")
		return true;

	else if (inputTexts == "OFF" || inputTexts == "Off" || inputTexts == "off")
		return false;

	else
		throw System::IO::InvalidFileException{ typeid(*this), "toNecessity", "Could not read necessity texts." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
