#include "FileStream.h"

#include <fstream>

using namespace System::IO;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructor

FileStream::FileStream() noexcept
	: _filePath{}
	, _fileMode{ FileMode::openRead }
{
}

FileStream::FileStream(const std::filesystem::path& filePath, const FileMode& fileMode)
	: _filePath{ filePath }
	, _fileMode{ fileMode }
{
	if (_fileMode == FileMode::append)
		File::createFile(_filePath, File::CreateOptions::skip_existing);

	if (_fileMode == FileMode::create)
		File::createFile(_filePath, File::CreateOptions::overwrite_existing);

	if (_fileMode == FileMode::createNew)
		File::createFile(_filePath, File::CreateOptions::none);

	if (_fileMode == FileMode::openRead)
	{
		if (!(File::exist(_filePath)))
		{
			std::string errorMessage;
			{
				errorMessage += "Could not find the file of \"";
				errorMessage += _filePath.generic_string();
				errorMessage += "\".";
			}

			throw FileNotFoundException(typeid(*this), "constructor", errorMessage);
		}
	}
}

// Constructor
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

void FileStream::set(const std::filesystem::path& filePath, const FileMode& fileMode)
{
	_filePath = filePath;
	_fileMode = fileMode;
	{
		if (_fileMode == FileMode::append)
			File::createFile(_filePath, File::CreateOptions::skip_existing);

		if (_fileMode == FileMode::create)
			File::createFile(_filePath, File::CreateOptions::overwrite_existing);

		if (_fileMode == FileMode::createNew)
			File::createFile(_filePath, File::CreateOptions::none);

		if (_fileMode == FileMode::openRead)
		{
			if (!(File::exist(_filePath)))
			{
				std::string errorMessage;
				{
					errorMessage += "Could not find the file of \"";
					errorMessage += _filePath.generic_string();
					errorMessage += "\".";
				}

				throw FileNotFoundException(typeid(*this), "constructor", errorMessage);
			}
		}
	}
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

std::vector<std::string> FileStream::readAllLines() const
{
	validateReadable();


	std::ifstream inputFileStream;
	inputFileStream.open(_filePath, std::ios_base::in);
	
	if (inputFileStream)
	{
		std::vector<std::string> fileLines;
		{
			for (std::string stringLine; std::getline(inputFileStream, stringLine);)
				fileLines.push_back(std::move(stringLine));
		}

		inputFileStream.close();
		return fileLines;
	}

	else
	{
		std::string errorMessage;
		{
			errorMessage += "Message : Could not open the file of \"";
			errorMessage += _filePath.generic_string();
			errorMessage += "\".";
		}

		throw FileNotFoundException(typeid(*this), "readAllLines", errorMessage);
	}

}

std::string FileStream::readAllTexts() const
{
	validateReadable();


	std::ifstream inputFileStream;
	inputFileStream.open(_filePath, std::ios_base::in);

	if (inputFileStream)
	{
		std::string fileTexts;
		{
			for (std::string stringLine; std::getline(inputFileStream, stringLine);)
			{
				fileTexts += std::move(stringLine);
				fileTexts += "\n";
			}
		}

		inputFileStream.close();
		return fileTexts;
	}

	else
	{
		std::string errorMessage;
		{
			errorMessage += "Message : Could not open the file of \"";
			errorMessage += _filePath.generic_string();
			errorMessage += "\".";
		}

		throw FileNotFoundException(typeid(*this), "readAllLines", errorMessage);
	}
}

void FileStream::write(const std::vector<std::string>& allLines) const
{
	if (!(allLines.empty()))
	{
		validateWritable();


		std::ofstream outputFileStream;
		outputFileStream.open(_filePath, std::ios_base::app);

		if (outputFileStream)
		{
			for (const auto& stringLine : allLines)
			{
				if (stringLine.empty())
					outputFileStream << "\n";

				else
				{
					outputFileStream << stringLine;
					outputFileStream << "\n";
				}
			}

			outputFileStream.close();
		}

		else
		{
			std::string errorMessage;
			{
				errorMessage += "Message : Could not open the file of \"";
				errorMessage += _filePath.generic_string();
				errorMessage += "\".";
			}

			throw FileNotFoundException(typeid(*this), "write", errorMessage);
		}
	}
}

void FileStream::write(const std::string& allTexts) const
{
	if (!(allTexts.empty()))
	{
		validateWritable();


		std::ofstream outputFileStream;
		outputFileStream.open(_filePath, std::ios_base::app);

		if (outputFileStream)
		{
			outputFileStream << allTexts;
			outputFileStream.close();
		}

		else
		{
			std::string errorMessage;
			{
				errorMessage += "Message : Could not open the file of \"";
				errorMessage += _filePath.generic_string();
				errorMessage += "\".";
			}

			throw FileNotFoundException(typeid(*this), "write", errorMessage);
		}
	}
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

void FileStream::validateFilePath() const
{
	if (!(File::exist(_filePath)))
	{
		std::string errorMessage;
		{
			errorMessage += "\"";
			errorMessage += _filePath.generic_string();
			errorMessage += "\" is invalid.";
		}

		throw FileNotFoundException(typeid(*this), "validateFilePath", errorMessage);
	}
}

void FileStream::validateReadable() const
{
	if (_fileMode == FileMode::openRead)
	{
		if (!(File::exist(_filePath)))
		{
			std::string errorMessage;
			{
				errorMessage += "Could not find the file of \"";
				errorMessage += _filePath.generic_string();
				errorMessage += "\".";
			}

			throw FileNotFoundException(typeid(*this), "validateReadable", errorMessage);
		}
	}

	else
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateReadable", "File mode is not \"openRead\"." };
}

void FileStream::validateWritable() const
{
	if ((_fileMode == FileMode::append) || (_fileMode == FileMode::create) || (_fileMode == FileMode::createNew))
	{
		if (!(File::exist(_filePath)))
		{
			std::string errorMessage;
			{
				errorMessage += "Could not find the file of \"";
				errorMessage += _filePath.generic_string();
				errorMessage += "\".";
			}

			throw FileNotFoundException(typeid(*this), "validateWritable", errorMessage);
		}
	}

	else
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "validateWritable", "File mode is not \"append\", \"create\", or \"createNew\"." };
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
