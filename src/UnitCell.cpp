#include "UnitCell.h"

using namespace ChemToolkit::Crystallography;


// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

UnitCell::UnitCell() noexcept
	: _basisVectors{}
{
	_basisVectors(0, 0) = 1.0;
	_basisVectors(1, 1) = 1.0;
	_basisVectors(2, 2) = 1.0;
}

UnitCell::UnitCell(const NumericalMatrix& basisVectors) noexcept
	: _basisVectors{ basisVectors }
{
}

UnitCell::UnitCell(NumericalMatrix&& basisVectors) noexcept
	: _basisVectors{ std::move(basisVectors) }
{
}

UnitCell::UnitCell(const LatticeParameters& latticeParameters)
	: _basisVectors{}
{
	{
		const double alphaRadian = latticeParameters.angles.alpha;
		const double betaRadian = latticeParameters.angles.beta;
		const double gammaRadian = latticeParameters.angles.gamma;
		_basisVectors(0, 0) = latticeParameters.lengths.a;
		_basisVectors(0, 1) = (latticeParameters.lengths.b * std::cos(gammaRadian));
		_basisVectors(1, 1) = (latticeParameters.lengths.b * std::sin(gammaRadian));
		_basisVectors(0, 2) = (latticeParameters.lengths.c * std::cos(betaRadian));
		_basisVectors(1, 2) = ((latticeParameters.lengths.c * (std::cos(alphaRadian) - (std::cos(betaRadian) * std::cos(gammaRadian)))) / std::sin(gammaRadian));
		_basisVectors(2, 2) = std::sqrt((latticeParameters.lengths.c * latticeParameters.lengths.c) - (_basisVectors(0, 2) * _basisVectors(0, 2)) - (_basisVectors(1, 2) * _basisVectors(1, 2)));
	}
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

UnitCell::LatticeParameters UnitCell::getLatticeParameters() const
{
	NumericalVector latticeVectorA = _basisVectors.columnVector(0);
	NumericalVector latticeVectorB = _basisVectors.columnVector(1);
	NumericalVector latticeVectorC = _basisVectors.columnVector(2);

	double a = latticeVectorA.norm();
	double b = latticeVectorB.norm();
	double c = latticeVectorC.norm();
	double alpha = getAngle(latticeVectorB, latticeVectorC);
	double beta = getAngle(latticeVectorC, latticeVectorA);
	double gamma = getAngle(latticeVectorA, latticeVectorB);

	LatticeParameters::Lengths lengths{ a,b,c };
	LatticeParameters::Angles angles{ alpha, beta, gamma };


	return LatticeParameters{ lengths, angles };
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
