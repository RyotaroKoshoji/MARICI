#ifndef CHEMTOOLKIT_CRYSTALLOGRAPHY_SYMMETRY_CRYSTALLOGRAPHICSYMMETRYOPERATION_H
#define CHEMTOOLKIT_CRYSTALLOGRAPHY_SYMMETRY_CRYSTALLOGRAPHICSYMMETRYOPERATION_H

#include <cmath>
#include <string>

#include "StreamReader.h"

#include "NumericalMatrix.h"
#include "AffineMapping.h"


namespace ChemToolkit
{
	namespace Crystallography
	{
		namespace Symmetry
		{
			class CrystallographicSymmetryOperation :public MathToolkit::LinearAlgebra::AffineMapping<double, 3, 3>
			{
				using NumericalVector = MathToolkit::LinearAlgebra::NumericalVector<double, 3>;
				using NumericalMatrix = MathToolkit::LinearAlgebra::NumericalMatrix<double, 3, 3>;

// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Constructors, destructor, and operators

			public:
				CrystallographicSymmetryOperation() noexcept;
				explicit CrystallographicSymmetryOperation(const NumericalMatrix&) noexcept;
				explicit CrystallographicSymmetryOperation(NumericalMatrix&&) noexcept;
				CrystallographicSymmetryOperation(const NumericalMatrix&, const NumericalVector&) noexcept;
				CrystallographicSymmetryOperation(NumericalMatrix&&, NumericalVector&&) noexcept;

				virtual ~CrystallographicSymmetryOperation() = default;

				CrystallographicSymmetryOperation(const CrystallographicSymmetryOperation&) = default;
				CrystallographicSymmetryOperation(CrystallographicSymmetryOperation&&) noexcept = default;
				CrystallographicSymmetryOperation& operator=(const CrystallographicSymmetryOperation&) = default;
				CrystallographicSymmetryOperation& operator=(CrystallographicSymmetryOperation&&) noexcept = default;

			// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Property

				double precision() const noexcept;
				static double defaultPrecision() noexcept;

				void setPrecision() noexcept;
				void setPrecision(const double);

			// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Methods

				std::string toString() const;

				static bool toCrystallographicSymmetryOperation(const std::string&, CrystallographicSymmetryOperation&);

			// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Private methods

			private:
				bool isZero(const double) const noexcept;
				bool isOne(const double) const noexcept;
				bool isMinusOne(const double) const noexcept;
				bool addOperationTerm(std::string&, const double) const;

				static double toTermValue(std::string termText);
				static CrystallographicSymmetryOperation toCrystallographicSymmetryOperation(const std::string& xOperation, const std::string& yOperation, const std::string& zOperation);

			// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

			private:
				double _precision;
				static double s_defaultPrecision;
			};
		}
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline double ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::precision() const noexcept
{
	return _precision;
}

inline double ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::defaultPrecision() noexcept
{
	return s_defaultPrecision;
}

inline void ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::setPrecision() noexcept
{
	_precision = s_defaultPrecision;
}

inline void ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::setPrecision(const double precision)
{
	if (0.0 < precision)
		_precision = precision;
	else
		throw System::ExceptionServices::ArgumentOutOfRangeException{ typeid(*this), "setPrecision", "\"precision\" is not more than zero." };
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

inline bool ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::isZero(const double value) const noexcept
{
	if (std::abs(value) < _precision)
		return true;
	else
		return false;
}

inline bool ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::isOne(const double value) const noexcept
{
	if ((std::abs(value - 1.0)) < _precision)
		return true;
	else
		return false;
}

inline bool ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::isMinusOne(const double value) const noexcept
{
	if ((std::abs(value + 1.0)) < _precision)
		return true;
	else
		return false;
}

inline double ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation::toTermValue(std::string termText)
{
	if (termText.empty())
		return 1.0;
	else
		return System::IO::StreamReader::toFractionalValue(termText);
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************

#endif // !CHEMTOOLKIT_CRYSTALLOGRAPHY_SYMMETRY_CRYSTALLOGRAPHICSYMMETRYOPERATION_H
