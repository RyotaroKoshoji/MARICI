#ifndef CHEMTOOLKIT_GENERIC_CHEMICALSYSTEM_H
#define CHEMTOOLKIT_GENERIC_CHEMICALSYSTEM_H

#include <algorithm>
#include <set>

#include "InvalidOperationException.h"


namespace ChemToolkit
{
	namespace Generic
	{
		template <typename A>
		class ChemicalSystem
		{
		public:
			using size_type = typename A::size_type;

			using iterator = typename std::set<A>::iterator;
			using const_iterator = typename std::set<A>::const_iterator;

// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			ChemicalSystem() noexcept = default;
			virtual ~ChemicalSystem() = default;

			ChemicalSystem(const ChemicalSystem&) = default;
			ChemicalSystem(ChemicalSystem&&) noexcept = default;
			ChemicalSystem& operator=(const ChemicalSystem&) = default;
			ChemicalSystem& operator=(ChemicalSystem&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Property

			iterator begin() noexcept;
			const_iterator begin() const noexcept;
			iterator end() noexcept;
			const_iterator end() const noexcept;

		// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			size_type countAtomicSpecies() const noexcept;
			bool contains(const A&) const;
			bool isEmpty() const noexcept;
			void clear() noexcept;

			std::string toString() const;
			std::size_t getHashCode() const;

			void add(const A&);
			void erase(const A&);
			void join(const ChemicalSystem&);

		// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			std::set<A> _atomicSpecies;
		};



		template <typename A>
		inline bool operator<(const ChemicalSystem<A>& csa, const ChemicalSystem<A>& csb) noexcept
		{
			return std::lexicographical_compare(csa.begin(), csa.end(), csb.begin(), csb.end());
		}

		template <typename A>
		inline bool operator>(const ChemicalSystem<A>& csa, const ChemicalSystem<A>& csb) noexcept
		{
			return (csb < csa);
		}

		template <typename A>
		inline bool operator==(const ChemicalSystem<A>& csa, const ChemicalSystem<A>& csb) noexcept
		{
			return std::equal(csa.begin(), csa.end(), csb.begin(), csb.end());;
		}

		template <typename A>
		inline bool operator!=(const ChemicalSystem<A>& csa, const ChemicalSystem<A>& csb) noexcept
		{
			return !(csa == csb);
		}
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

template <typename A>
inline typename ChemToolkit::Generic::ChemicalSystem<A>::iterator ChemToolkit::Generic::ChemicalSystem<A>::begin() noexcept
{
	return _atomicSpecies.begin();
}

template <typename A>
inline typename ChemToolkit::Generic::ChemicalSystem<A>::const_iterator ChemToolkit::Generic::ChemicalSystem<A>::begin() const noexcept
{
	return _atomicSpecies.begin();
}

template <typename A>
inline typename ChemToolkit::Generic::ChemicalSystem<A>::iterator ChemToolkit::Generic::ChemicalSystem<A>::end() noexcept
{
	return _atomicSpecies.end();
}

template <typename A>
inline typename ChemToolkit::Generic::ChemicalSystem<A>::const_iterator ChemToolkit::Generic::ChemicalSystem<A>::end() const noexcept
{
	return _atomicSpecies.end();
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

template <typename A>
inline typename ChemToolkit::Generic::ChemicalSystem<A>::size_type ChemToolkit::Generic::ChemicalSystem<A>::countAtomicSpecies() const noexcept
{
	return static_cast<size_type>(_atomicSpecies.size());
}

template <typename A>
inline bool ChemToolkit::Generic::ChemicalSystem<A>::contains(const A& atom) const
{
	return !(_atomicSpecies.find(atom) == _atomicSpecies.end());
}

template <typename A>
inline bool ChemToolkit::Generic::ChemicalSystem<A>::isEmpty() const noexcept
{
	return _atomicSpecies.empty();
}

template <typename A>
inline void ChemToolkit::Generic::ChemicalSystem<A>::clear() noexcept
{
	_atomicSpecies.clear();
}

template <typename A>
inline std::string ChemToolkit::Generic::ChemicalSystem<A>::toString() const
{
	if (!(isEmpty()))
	{
		std::string compositionName;
		{
			for (const auto& atom : _atomicSpecies)
			{
				compositionName += atom.toElementSymbol();
				compositionName += "_";
			}

			compositionName.pop_back();
		}

		return compositionName;
	}

	else
		throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "toString", "This is invalid." };
}

template <typename A>
inline std::size_t ChemToolkit::Generic::ChemicalSystem<A>::getHashCode() const
{
	std::string hashName;
	{
		for (const auto& atom : _atomicSpecies)
		{
			hashName += atom.toHashString();
			hashName += "_";
		}
	}

	return std::hash<std::string>{}(hashName);
}

template <typename A>
inline void ChemToolkit::Generic::ChemicalSystem<A>::add(const A& atom)
{
	_atomicSpecies.emplace(atom);
}

template <typename A>
inline void ChemToolkit::Generic::ChemicalSystem<A>::erase(const A& atom)
{
	_atomicSpecies.erase(atom);
}

template <typename A>
inline void ChemToolkit::Generic::ChemicalSystem<A>::join(const ChemicalSystem& chemicalSystem)
{
	for (const auto& atom : chemicalSystem._atomicSpecies)
		add(atom);
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !CHEMTOOLKIT_GENERIC_CHEMICALSYSTEM_H
