#ifndef CHEMTOOLKIT_CRYSTALLOGRAPHY_CRYSTALLOGRAPHICINFORMATION_H
#define CHEMTOOLKIT_CRYSTALLOGRAPHY_CRYSTALLOGRAPHICINFORMATION_H


#include <vector>
#include "ArgumentOutOfRangeException.h"
#include "NumericalVector.h"

#include "ChemicalComposition.h"
#include "SpaceGroupNumber.h"

#include "UnitCell.h"
#include "AtomSite.h"
#include "CrystallographicSymmetryOperation.h"
#include "CrystallographicAtom.h"


namespace ChemToolkit
{
	namespace Crystallography
	{
		template <typename A>
		class CrystallographicStructure;


		class CrystallographicInformation
		{
			using NumericalVector = MathToolkit::LinearAlgebra::NumericalVector<double, 3>;
			using AtomicNumber = ChemToolkit::Generic::AtomicNumber;

			using UnitCell = ChemToolkit::Crystallography::UnitCell;
			using SymmetryOperation = ChemToolkit::Crystallography::Symmetry::CrystallographicSymmetryOperation;
			using SpaceGroupNumber = ChemToolkit::Crystallography::Symmetry::SpaceGroupNumber;

		public:
			using size_type = unsigned short;

// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			CrystallographicInformation() noexcept;
			virtual ~CrystallographicInformation() = default;

			CrystallographicInformation(const CrystallographicInformation&) = default;
			CrystallographicInformation(CrystallographicInformation&&) noexcept = default;
			CrystallographicInformation& operator=(const CrystallographicInformation&) = default;
			CrystallographicInformation& operator=(CrystallographicInformation&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Property

			std::string structureName() const noexcept;
			const UnitCell& unitCell() const noexcept;
			const std::vector<AtomSite>& atomSites() const noexcept;

			SpaceGroupNumber spaceGroupNumber() const noexcept;
			const std::vector<SymmetryOperation>& symmetryOperations() const noexcept;


			void setStructureName(const std::string& name = std::string{}) noexcept;
			void setUnitCell(const UnitCell&) noexcept;
			void setAtomSites(const std::vector<AtomSite>&) noexcept;
			void setAtomSites(std::vector<AtomSite>&&) noexcept;

			void setSpaceGroupNumber(const SpaceGroupNumber) noexcept;
			void setSymmetryOperations(const std::vector<SymmetryOperation>&) noexcept;
			void setSymmetryOperations(std::vector<SymmetryOperation>&&) noexcept;

		// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			ChemToolkit::Generic::ChemicalComposition<AtomicNumber> toChemicalComposition() const;
			CrystallographicStructure<CrystallographicAtom> toCrystallographicStructure() const;

			bool hasPartiallyFilledAtomSites() const noexcept;
			virtual void clear() noexcept;

		// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Private methods

		private:
			bool isSameAtom(const CrystallographicAtom&, const CrystallographicAtom&, const double coordinatePrecision) const noexcept;

		// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			std::string _structureName;
			UnitCell _unitCell;
			std::vector<AtomSite> _atomSites;

			SpaceGroupNumber _spaceGroupNumber;
			std::vector<SymmetryOperation> _symmetryOperations;
		};
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline std::string ChemToolkit::Crystallography::CrystallographicInformation::structureName() const noexcept
{
	if (_structureName.empty())
		toChemicalComposition().toString();
	else
		return _structureName;
}

inline const ChemToolkit::Crystallography::UnitCell& ChemToolkit::Crystallography::CrystallographicInformation::unitCell() const noexcept
{
	return _unitCell;
}

inline const std::vector<ChemToolkit::Crystallography::AtomSite>& ChemToolkit::Crystallography::CrystallographicInformation::atomSites() const noexcept
{
	return _atomSites;
}

inline ChemToolkit::Crystallography::CrystallographicInformation::SpaceGroupNumber ChemToolkit::Crystallography::CrystallographicInformation::spaceGroupNumber() const noexcept
{
	return _spaceGroupNumber;
}

inline const std::vector<ChemToolkit::Crystallography::CrystallographicInformation::SymmetryOperation>& ChemToolkit::Crystallography::CrystallographicInformation::symmetryOperations() const noexcept
{
	return _symmetryOperations;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setStructureName(const std::string& name) noexcept
{
	_structureName = name;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setUnitCell(const UnitCell& cell) noexcept
{
	_unitCell = cell;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setAtomSites(const std::vector<AtomSite>& sites) noexcept
{
	_atomSites = sites;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setAtomSites(std::vector<AtomSite>&& sites) noexcept
{
	_atomSites = std::move(sites);
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setSpaceGroupNumber(const SpaceGroupNumber number) noexcept
{
	_spaceGroupNumber = number;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setSymmetryOperations(const std::vector<SymmetryOperation>& operations) noexcept
{
	_symmetryOperations = operations;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::setSymmetryOperations(std::vector<SymmetryOperation>&& operations) noexcept
{
	_symmetryOperations = std::move(operations);
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline ChemToolkit::Generic::ChemicalComposition<ChemToolkit::Generic::AtomicNumber> ChemToolkit::Crystallography::CrystallographicInformation::toChemicalComposition() const
{
	ChemToolkit::Generic::ChemicalComposition<AtomicNumber> chemicalComposition;
	{
		for (const auto& atomSite : _atomSites)
			chemicalComposition.add(atomSite.atomicNumber(), atomSite.siteMultiplicity());
	}

	return chemicalComposition;
}

inline bool ChemToolkit::Crystallography::CrystallographicInformation::hasPartiallyFilledAtomSites() const noexcept
{
	for (const auto& atomSite : _atomSites)
	{
		if (atomSite.siteOccupancy() < 1.0)
			return true;
	}

	return false;
}

inline void ChemToolkit::Crystallography::CrystallographicInformation::clear() noexcept
{
	_structureName.clear();
	_unitCell.clear();
	_atomSites.clear();

	_spaceGroupNumber.set();
	_symmetryOperations.clear();
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Private methods

inline bool ChemToolkit::Crystallography::CrystallographicInformation::isSameAtom(const CrystallographicAtom& atomA, const CrystallographicAtom& atomB, const double coordinatePrecision) const noexcept
{
	if (atomA.ionicAtomicNumber().atomicNumber() == atomB.ionicAtomicNumber().atomicNumber())
	{
		if ((atomB.cartesianCoordinate() - atomA.cartesianCoordinate()).normSquare() < (coordinatePrecision * coordinatePrecision))
			return true;
		else
			return false;
	}

	else
		return false;
}

// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !CHEMTOOLKIT_CRYSTALLOGRAPHY_CRYSTALLOGRAPHICINFORMATION_H
