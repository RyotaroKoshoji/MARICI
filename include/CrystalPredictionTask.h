#ifndef MATHEMATICALCRYSTALCHEMISTRY_PREDICTION_CRYSTALPREDICTIONTASK_H
#define MATHEMATICALCRYSTALCHEMISTRY_PREDICTION_CRYSTALPREDICTIONTASK_H

#include <unordered_map>
#include <utility>

#include "ArgumentOutOfRangeException.h"
#include "InvalidOperationException.h"
#include "StreamReader.h"

#include "ChemicalComposition.h"

#include "ConstrainingAtomicSpecies.h"

#include "CrystalProductionReportParameters.h"
#include "CrystalDesignParameters.h"


namespace MathematicalCrystalChemistry
{
	namespace Prediction
	{
		class CrystalPredictionTask
		{
			using size_type = std::size_t;

			using ConstrainingAtomicSpecies = MathematicalCrystalChemistry::CrystalModel::Components::ConstrainingAtomicSpecies;
			using ChemicalComposition = ChemToolkit::Generic::ChemicalComposition<ConstrainingAtomicSpecies>;

			using CrystalDesignParameters = MathematicalCrystalChemistry::Design::CrystalDesignParameters;
			using CrystalProductionReportParameters = MathematicalCrystalChemistry::Design::Diagnostics::CrystalProductionReportParameters;

// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			CrystalPredictionTask() noexcept;
			virtual ~CrystalPredictionTask() = default;

			CrystalPredictionTask(const CrystalPredictionTask&) = default;
			CrystalPredictionTask(CrystalPredictionTask&&) noexcept = default;
			CrystalPredictionTask& operator=(const CrystalPredictionTask&) = default;
			CrystalPredictionTask& operator=(CrystalPredictionTask&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Property

			const std::unordered_map<ChemicalComposition, size_type, ChemicalComposition::Hasher>& crystalDesignRequest() const noexcept;

			const CrystalProductionReportParameters& crystalProductionReportParameters() const noexcept;
			const CrystalDesignParameters& crystalDesignParameters() const noexcept;


			void setCrystalProductionReportParameters(const CrystalProductionReportParameters&) noexcept;
			void setCrystalDesignParameters(const CrystalDesignParameters&) noexcept;

		// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			void initialize() noexcept;
			void initialize(const System::IO::StreamReader&);

			void addChemicalComposition(const ChemicalComposition&, const size_type randomCrystalProducing);

		// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Private methods

		private:
			void initializeCrystalDesignRequest(const System::IO::StreamReader&);

		// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Private utility

			std::pair<ConstrainingAtomicSpecies, ConstrainingAtomicSpecies::size_type> toChemicalComposition(const std::string&) const;

		// Private utility
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			std::unordered_map<ChemicalComposition, size_type, ChemicalComposition::Hasher> _crystalDesignRequest;

			CrystalProductionReportParameters _crystalProductionReportParameters;
			CrystalDesignParameters _crystalDesignParameters;
		};
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline const std::unordered_map<MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::ChemicalComposition, std::size_t, MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::ChemicalComposition::Hasher>& MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::crystalDesignRequest() const noexcept
{
	return _crystalDesignRequest;
}

inline const MathematicalCrystalChemistry::Design::Diagnostics::CrystalProductionReportParameters& MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::crystalProductionReportParameters() const noexcept
{
	return _crystalProductionReportParameters;
}

inline const MathematicalCrystalChemistry::Design::CrystalDesignParameters& MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::crystalDesignParameters() const noexcept
{
	return _crystalDesignParameters;
}

inline void MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::setCrystalProductionReportParameters(const CrystalProductionReportParameters& parameters) noexcept
{
	_crystalProductionReportParameters = parameters;
}

inline void MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::setCrystalDesignParameters(const CrystalDesignParameters& parameters) noexcept
{
	_crystalDesignParameters = parameters;
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline void MathematicalCrystalChemistry::Prediction::CrystalPredictionTask::addChemicalComposition(const ChemicalComposition& chemicalComposition, const size_type randomCrystalProducing)
{
	if (randomCrystalProducing == 0)
		throw System::ExceptionServices::ArgumentOutOfRangeException{ typeid(*this), "add", "The number of randomly crystal producing is zero." };

	else
	{
		auto iter = _crystalDesignRequest.find(chemicalComposition);

		if (iter == _crystalDesignRequest.end())
			_crystalDesignRequest.emplace(chemicalComposition, randomCrystalProducing);
		else
			throw System::ExceptionServices::InvalidOperationException{ typeid(*this), "add", "Argument chemical composition has already been registered." };
	}
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !MATHEMATICALCRYSTALCHEMISTRY_PREDICTION_CRYSTALPREDICTIONTASK_H
