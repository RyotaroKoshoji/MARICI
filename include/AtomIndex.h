#ifndef CHEMTOOLKIT_CRYSTALLOGRAPHY_ATOMINDEX_H
#define CHEMTOOLKIT_CRYSTALLOGRAPHY_ATOMINDEX_H

#include <string>
#include <array>
#include <vector>
#include <limits>
#include <functional>
#include <type_traits>

#include "ArgumentOutOfRangeException.h"
#include "ArithmeticException.h"
#include "NumericalVector.h"


namespace ChemToolkit
{
	namespace Crystallography
	{
		using OriginalAtomIndex = unsigned short;


		class TranslatedAtomIndex final
		{
		public:
			using lattice_point_value_type = short;
			using LatticePoint = std::array<lattice_point_value_type, 3>;
			using NumericalVector = MathToolkit::LinearAlgebra::NumericalVector<double, 3>;

// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			TranslatedAtomIndex() noexcept;
			explicit TranslatedAtomIndex(const OriginalAtomIndex) noexcept;
			TranslatedAtomIndex(const OriginalAtomIndex, const LatticePoint&) noexcept;

			~TranslatedAtomIndex() = default;

			TranslatedAtomIndex(const TranslatedAtomIndex&) = default;
			TranslatedAtomIndex(TranslatedAtomIndex&&) noexcept = default;
			TranslatedAtomIndex& operator=(const TranslatedAtomIndex&) = default;
			TranslatedAtomIndex& operator=(TranslatedAtomIndex&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Property

			OriginalAtomIndex originalIndex() const noexcept;
			const LatticePoint& latticePoint() const noexcept;

		// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			std::size_t getHashCode() const noexcept;

			bool isInOriginalCell() const noexcept;
			bool hasSameLatticePoint(const TranslatedAtomIndex&) const noexcept;
			void reverseLatticePoint() noexcept;

			TranslatedAtomIndex toReverseIndex() const noexcept;
			TranslatedAtomIndex toTranslatedIndex(const LatticePoint&) const noexcept;

			LatticePoint getRelativeLatticePointTo(const TranslatedAtomIndex&) const noexcept;
			NumericalVector getLatticePointVector() const noexcept;

		// Properties
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			OriginalAtomIndex _originalIndex;
			LatticePoint _latticePoint;
		};



		inline bool operator<(const TranslatedAtomIndex& taia, const TranslatedAtomIndex& taib) noexcept
		{
			if (taia.originalIndex() < taib.originalIndex())
				return true;

			else if (taia.originalIndex() == taib.originalIndex())
				return (taia.latticePoint() < taib.latticePoint());

			else
				return false;
		}

		inline bool operator>(const TranslatedAtomIndex& taia, const TranslatedAtomIndex& taib) noexcept
		{
			return (taib < taia);
		}

		inline bool operator==(const TranslatedAtomIndex& taia, const TranslatedAtomIndex& taib) noexcept
		{
			return ((taia.originalIndex() == taib.originalIndex()) && (taia.latticePoint() == taib.latticePoint()));
		}

		inline bool operator!=(const TranslatedAtomIndex& taia, const TranslatedAtomIndex& taib) noexcept
		{
			return !(taia == taib);
		}
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Constructors

inline ChemToolkit::Crystallography::TranslatedAtomIndex::TranslatedAtomIndex() noexcept
	: _originalIndex{ 0 }
	, _latticePoint{ 0,0,0 }
{
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex::TranslatedAtomIndex(const OriginalAtomIndex index) noexcept
	: _originalIndex{ index }
	, _latticePoint{ 0,0,0 }
{
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex::TranslatedAtomIndex(const OriginalAtomIndex index, const LatticePoint& point) noexcept
	: _originalIndex{ index }
	, _latticePoint{ point[0], point[1], point[2] }
{
}

// Constructors
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline ChemToolkit::Crystallography::OriginalAtomIndex ChemToolkit::Crystallography::TranslatedAtomIndex::originalIndex() const noexcept
{
	return _originalIndex;
}

inline const ChemToolkit::Crystallography::TranslatedAtomIndex::LatticePoint& ChemToolkit::Crystallography::TranslatedAtomIndex::latticePoint() const noexcept
{
	return _latticePoint;
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline std::size_t ChemToolkit::Crystallography::TranslatedAtomIndex::getHashCode() const noexcept
{
	std::size_t hashCode = std::hash<OriginalAtomIndex>{}(_originalIndex);
	{
		std::string latticeString;
		{
			for (const auto num : _latticePoint)
			{
				latticeString += std::to_string(num);
				latticeString += ',';
			}
		}

		hashCode ^= std::hash<std::string>{}(latticeString);
	}

	return hashCode;
}

inline bool ChemToolkit::Crystallography::TranslatedAtomIndex::isInOriginalCell() const noexcept
{
	for (const auto val : _latticePoint)
	{
		if (val != 0)
			return false;
	}

	return true;
}

inline bool ChemToolkit::Crystallography::TranslatedAtomIndex::hasSameLatticePoint(const TranslatedAtomIndex& atomIndex) const noexcept
{
	if (_latticePoint[0] != atomIndex._latticePoint[0])
		return false;

	if (_latticePoint[1] != atomIndex._latticePoint[1])
		return false;

	if (_latticePoint[2] != atomIndex._latticePoint[2])
		return false;

	return true;
}

inline void ChemToolkit::Crystallography::TranslatedAtomIndex::reverseLatticePoint() noexcept
{
	_latticePoint[0] *= (-1);
	_latticePoint[1] *= (-1);
	_latticePoint[2] *= (-1);
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex ChemToolkit::Crystallography::TranslatedAtomIndex::toReverseIndex() const noexcept
{
	TranslatedAtomIndex atomIndex{ _originalIndex, _latticePoint };
	atomIndex.reverseLatticePoint();
	return atomIndex;
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex ChemToolkit::Crystallography::TranslatedAtomIndex::toTranslatedIndex(const LatticePoint& lp) const noexcept
{
	LatticePoint translatedLatticePoint{ _latticePoint[0], _latticePoint[1], _latticePoint[2] };
	{
		translatedLatticePoint[0] += lp[0];
		translatedLatticePoint[1] += lp[1];
		translatedLatticePoint[2] += lp[2];
	}

	return TranslatedAtomIndex{ _originalIndex, translatedLatticePoint };
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex::LatticePoint ChemToolkit::Crystallography::TranslatedAtomIndex::getRelativeLatticePointTo(const TranslatedAtomIndex& atomIndex) const noexcept
{
	LatticePoint relativeLatticePoint{ atomIndex._latticePoint[0], atomIndex._latticePoint[1], atomIndex._latticePoint[2] };
	{
		relativeLatticePoint[0] -= _latticePoint[0];
		relativeLatticePoint[1] -= _latticePoint[1];
		relativeLatticePoint[2] -= _latticePoint[2];
	}

	return relativeLatticePoint;
}

inline ChemToolkit::Crystallography::TranslatedAtomIndex::NumericalVector ChemToolkit::Crystallography::TranslatedAtomIndex::getLatticePointVector() const noexcept
{
	return NumericalVector{ static_cast<double>(_latticePoint[0]), static_cast<double>(_latticePoint[1]), static_cast<double>(_latticePoint[2]) };
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !CHEMTOOLKIT_CRYSTALLOGRAPHY_ATOMINDEX_H
