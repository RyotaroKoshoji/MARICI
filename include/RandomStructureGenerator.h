#ifndef MATHEMATICALCRYSTALCHEMISTRY_DESIGN_GENERATION_RANDOMSTRUCTUREGENERATOR_H
#define MATHEMATICALCRYSTALCHEMISTRY_DESIGN_GENERATION_RANDOMSTRUCTUREGENERATOR_H

#include <random>

#include "NumericalVector.h"
#include "NumericalMatrix.h"

#include "ChemicalComposition.h"

#include "ConstrainingAtomicSpecies.h"
#include "ConstrainingAtom.h"
#include "ConstrainingCrystalStructure.h"

#include "RandomStructureGenerationParameters.h"


namespace MathematicalCrystalChemistry
{
	namespace Design
	{
		namespace Generation
		{
			class RandomStructureGenerator
			{
				using size_type = std::size_t;
				using NumericalVector = MathToolkit::LinearAlgebra::NumericalVector<double, 3>;
				using NumericalMatrix = MathToolkit::LinearAlgebra::NumericalMatrix<double, 3, 3>;

				using ConstrainingAtomicSpecies = MathematicalCrystalChemistry::CrystalModel::Components::ConstrainingAtomicSpecies;
				using ChemicalComposition = ChemToolkit::Generic::ChemicalComposition<ConstrainingAtomicSpecies>;

				using ConstrainingAtom = MathematicalCrystalChemistry::CrystalModel::Components::ConstrainingAtom;
				using ConstrainingCrystalStructure = MathematicalCrystalChemistry::CrystalModel::Components::ConstrainingCrystalStructure;

// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Constructors, destructor, and operators

			public:
				RandomStructureGenerator() noexcept;
				explicit RandomStructureGenerator(const RandomStructureGenerationParameters&);
				virtual ~RandomStructureGenerator() = default;

				RandomStructureGenerator(const RandomStructureGenerator&) = default;
				RandomStructureGenerator(RandomStructureGenerator&&) noexcept = default;
				RandomStructureGenerator& operator=(const RandomStructureGenerator&) = default;
				RandomStructureGenerator& operator=(RandomStructureGenerator&&) noexcept = default;

			// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Property

				const RandomStructureGenerationParameters& randomStructureGenerationParameters() const noexcept;

				void setGeneratingChemicalComposition() noexcept;
				void setGeneratingChemicalComposition(const ChemicalComposition&);
				void setRandomStructureGenerationParameters(const RandomStructureGenerationParameters&);

			// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Methods

				ConstrainingCrystalStructure next() const;
				void next(ConstrainingCrystalStructure&) const;

				bool isValid() const noexcept;

			// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
			// Private methods

			private:
				void updateOutputUnitCellVolume() const;

			// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

			private:
				RandomStructureGenerationParameters _randomStructureGenerationParameters;
				ChemicalComposition _generatingComposition;

				mutable std::mt19937 m_randomEngine;
				mutable std::uniform_real_distribution<double> m_latticeLengthGenerator;
				mutable std::uniform_real_distribution<double> m_latticeAngleGenerator;
				mutable std::uniform_real_distribution<double> m_fractionalCoordinateGenerator;

				mutable double m_outputUnitCellVolume;
			};
		}
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline const MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerationParameters& MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::randomStructureGenerationParameters() const noexcept
{
	return _randomStructureGenerationParameters;
}

inline void MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::setGeneratingChemicalComposition() noexcept
{
	_generatingComposition.clear();
	m_outputUnitCellVolume = 1.0;
}

inline void MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::setGeneratingChemicalComposition(const ChemicalComposition& composition)
{
	_generatingComposition = composition;
	updateOutputUnitCellVolume();
}

inline void MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::setRandomStructureGenerationParameters(const RandomStructureGenerationParameters& parameters)
{
	_randomStructureGenerationParameters = parameters;

	m_latticeLengthGenerator = std::uniform_real_distribution<double>{ 1.0, _randomStructureGenerationParameters.maxInitialLatticeLengthRatio() };
	m_latticeAngleGenerator = std::uniform_real_distribution<double>{ _randomStructureGenerationParameters.minInitialLatticeAngle(), _randomStructureGenerationParameters.maxInitialLatticeAngle() };
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::ConstrainingCrystalStructure MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::RandomStructureGenerator::next() const
{
	ConstrainingCrystalStructure constrainingCrystalStructure;
	next(constrainingCrystalStructure);

	return constrainingCrystalStructure;
}

inline bool MathematicalCrystalChemistry::Design::Generation::RandomStructureGenerator::isValid() const noexcept
{
	if (_generatingComposition.isEmpty())
		return false;
	else
		return true;
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !MATHEMATICALCRYSTALCHEMISTRY_DESIGN_GENERATION_RANDOMSTRUCTUREGENERATOR_H
