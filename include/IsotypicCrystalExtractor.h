#ifndef MATHEMATICALCRYSTALCHEMISTRY_ANALYSIS_ISOTYPICCRYSTALEXTRACTOR_H
#define MATHEMATICALCRYSTALCHEMISTRY_ANALYSIS_ISOTYPICCRYSTALEXTRACTOR_H

#include "ArgumentOutOfRangeException.h"

#include "OptimalCrystalStructure.h"

#include "IsotypicCrystalExtractionParameters.h"


namespace MathematicalCrystalChemistry
{
	namespace Analysis
	{
		class IsotypicCrystalExtractor
		{
			using OptimalAtom = MathematicalCrystalChemistry::CrystalModel::Components::OptimalAtom;
			using OptimalCrystalStructure = MathematicalCrystalChemistry::CrystalModel::Components::OptimalCrystalStructure;

// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			IsotypicCrystalExtractor() noexcept;
			explicit IsotypicCrystalExtractor(const IsotypicCrystalExtractionParameters&) noexcept;

			virtual ~IsotypicCrystalExtractor() = default;

			IsotypicCrystalExtractor(const IsotypicCrystalExtractor&) = default;
			IsotypicCrystalExtractor(IsotypicCrystalExtractor&&) noexcept = default;
			IsotypicCrystalExtractor& operator=(const IsotypicCrystalExtractor&) = default;
			IsotypicCrystalExtractor& operator=(IsotypicCrystalExtractor&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Property

			const IsotypicCrystalExtractionParameters& crystalIdentificationParameters() const noexcept;

			void setIsotypicCrystalExtractionParameters(const IsotypicCrystalExtractionParameters&) noexcept;

		// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			bool isSame(const OptimalCrystalStructure&, const OptimalCrystalStructure&) const;
			bool isRegisteredCrystal(const OptimalCrystalStructure&) const;

		// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Private methods

		private:
			std::string readFingerprint(const std::filesystem::path&) const;

		// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			IsotypicCrystalExtractionParameters _crystalIdentificationParameters;
		};
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Property

inline const MathematicalCrystalChemistry::Analysis::IsotypicCrystalExtractionParameters& MathematicalCrystalChemistry::Analysis::IsotypicCrystalExtractor::crystalIdentificationParameters() const noexcept
{
	return _crystalIdentificationParameters;
}

inline void MathematicalCrystalChemistry::Analysis::IsotypicCrystalExtractor::setIsotypicCrystalExtractionParameters(const IsotypicCrystalExtractionParameters& parameters) noexcept
{
	_crystalIdentificationParameters = parameters;
}

// Property
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline bool MathematicalCrystalChemistry::Analysis::IsotypicCrystalExtractor::isSame(const OptimalCrystalStructure& formerStructure, const OptimalCrystalStructure& latterStructure) const
{
	OptimalCrystalStructure formerConventionalStructure = formerStructure;
	OptimalCrystalStructure latterConventionalStructure = latterStructure;
	{
		formerConventionalStructure.conventionalizeStructure(_crystalIdentificationParameters.spaceGroupPrecision());
		latterConventionalStructure.conventionalizeStructure(_crystalIdentificationParameters.spaceGroupPrecision());
	}

	if (formerConventionalStructure.toStructuralFingerprint() == latterConventionalStructure.toStructuralFingerprint())
		return true;
	else
		return false;
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !MATHEMATICALCRYSTALCHEMISTRY_ANALYSIS_ISOTYPICCRYSTALEXTRACTOR_H
