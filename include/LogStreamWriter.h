#ifndef SYSTEM_IO_LOGSTREAMWRITER_H
#define SYSTEM_IO_LOGSTREAMWRITER_H

#include <exception>
#include <mutex>

#include "IException.h"

#include "FileStream.h"


namespace System
{
	namespace IO
	{
		class LogStreamWriter :private FileStream
		{
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Constructors, destructor, and operators

		public:
			LogStreamWriter() noexcept;
			explicit LogStreamWriter(const std::filesystem::path& directoryPath);

			virtual ~LogStreamWriter() = default;

			LogStreamWriter(const LogStreamWriter&) = default;
			LogStreamWriter(LogStreamWriter&&) noexcept = default;
			LogStreamWriter& operator=(const LogStreamWriter&) = default;
			LogStreamWriter& operator=(LogStreamWriter&&) noexcept = default;

		// Constructors, destructor, and operators
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Methods

			bool isAvailable() const noexcept;
			void setDirectoryPath(const std::filesystem::path& directoryPath);

			void write(const std::exception&) const;
			void write(const System::ExceptionServices::IException&) const;


			static std::string getLogFilename() noexcept;
			static void eraseLogFile(const std::filesystem::path& directoryPath);

		// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
		// Private methods

		private:
			static std::string writeHeaderMessage() noexcept;

		// Private methods
// **********************************************************************************************************************************************************************************************************************************************************************************************

		private:
			static std::mutex s_logMutex;
		};
	}
}

// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// Methods

inline bool System::IO::LogStreamWriter::isAvailable() const noexcept
{
	return canWrite();
}

inline void System::IO::LogStreamWriter::write(const std::exception& e) const
{
	std::string message = e.what();
	message += "\n\n";

	std::lock_guard<std::mutex> guard{ s_logMutex };
	FileStream::write(message);
}

inline void System::IO::LogStreamWriter::write(const System::ExceptionServices::IException& e) const
{
	std::string message = e.toString();
	message += "\n\n";

	std::lock_guard<std::mutex> guard{ s_logMutex };
	FileStream::write(message);
}

inline std::string System::IO::LogStreamWriter::getLogFilename() noexcept
{
	return std::string{ "log.txt" };
}

// Methods
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************
// **********************************************************************************************************************************************************************************************************************************************************************************************


#endif // !SYSTEM_IO_LOGSTREAMWRITER_H
